var ang=angular.module("myapp",["ngRoute","ngAnimate"]);ang.config(["$routeProvider",function(e){e.when("/home",{templateUrl:"views/home.html",controller:"homeCtrl as home"}).when("/contact",{templateUrl:"views/contact.html"}).when("/login",{templateUrl:"views/login-Form.html",controller:"loginCtrl as login"}).when("/success",{templateUrl:"views/success-message.html",controller:"homeCtrl as home"}).when("/signup",{templateUrl:"views/signup-form.html",controller:"signupCtrl as signup"}).when("/profile",{templateUrl:"views/profile.html",controller:"profileCtrl as profile"}).when("/message",{templateUrl:"views/chat-message.html",controller:"chatCtrl as chat"}).when("/viwMsgScreen",{templateUrl:"views/viewMessageScreen.html",controller:"viewCtrl as view"}).otherwise({redirectTo:"/home"})}]),function(){ang.controller("accountHeader",[function(){this.logout=function(){localStorage.removeItem("userId")}}])}(),function(){ang.controller("chatCtrl",["$http","$location","$rootScope",function(e,t,s){function n(){return e.post("/getUserInfo/"+a).success(function(e){i.userINFO=e,i.inboxMessages=e.message.reverse()})}var i=this;if(localStorage.getItem("userId"))var a=localStorage.getItem("userId");else alert("User not logged-in. Please login again"),t.path("/home");n(),setInterval(function(){n()},5e3),this.flag=!1,this.changeFlag=function(){this.flag=!this.flag},this.sendMsg=function(){var t=i.userINFO.email,s=new Date,l=s.getDate().toString()+"/"+(s.getMonth()+1).toString()+"/"+s.getFullYear().toString();i.message.date=l,i.message.from=t,i.message.sendersId=a;var r=i.message,o=i.message.to;e.post("/msgReceiver/"+o).success(function(t){i.receiversInfo=t,""==i.receiversInfo?alert("Please enter a valid Email"):(i.receiversInfo.message.push(r),e.put("/sendMsg/"+i.receiversInfo._id,i.receiversInfo).success(function(e){i.message="",i.changeFlag(),n()}))})},this.viewMsg=function(e){var n=i.userINFO.message[e].from,a=i.userINFO.message[e].to,l=i.userINFO.message[e].message,r=i.userINFO.message[e].date,o=i.userINFO.message[e].sendersId;s.viewRow={from:n,to:a,message:l,date:r,sendersId:o},t.path("/viwMsgScreen")},this.deleteMsg=function(t){i.userINFO.message.splice(t,1),e.put("/deleteRequest/"+a,i.userINFO).success(function(e){})}}])}(),function(){ang.controller("homeCtrl",["$location",function(e){this.loginPageTransfer=function(){e.path("login")},this.signupPageTransfer=function(){e.path("signup")}}])}(),function(){ang.controller("loginCtrl",["$http","$location",function(e,t){var s=this;this.validateUserDetails=function(){e.post("/login",s.customer).success(function(e){""==e?alert("Please enter a valid Username and Password"):(void 0!==localStorage?localStorage.setItem("userId",e):alert("Local storage not available at your computer"),t.path("profile"))})}}])}(),function(){ang.controller("profileCtrl",["$http",function(e){this.editMode=!1;var t=this;if(this.trigerEditMode=function(){this.editMode=!this.editMode},"undefined"!==localStorage)if(localStorage.getItem("userId")){var s=localStorage.getItem("userId");e.get("/profile/"+s).success(function(e){t.userProfile=e})}else window.alert("There is no data in local storage");else window.alert("Local storage not available at your computer");this.saveUpdatedInfo=function(){var s=t.userProfile,n=s._id;e.put("/update"+n,s).success(function(e){t.userProfile=e}),t.trigerEditMode()}}])}(),function(){ang.controller("signupCtrl",["$location","$http",function(e,t){var s=this;this.validateInput=function(){function n(){s.user.message=[],t.post("/signup",s.user).success(function(t){e.path("success")})}function i(){return"display:;"==document.getElementById("invalidFirstname").getAttribute("style")?alert("Invalid Firstname"):"display:;"==document.getElementById("invalidLastname").getAttribute("style")?alert("Invalid Lastname"):"display:;"==document.getElementById("invalidusername").getAttribute("style")?alert("Invalid Username"):"display:;"==document.getElementById("invalidEmail").getAttribute("style")?alert("Invalid Email"):"display:;"==document.getElementById("invalidPassword").getAttribute("style")?alert("Invalid Password"):"display:;"==document.getElementById("invalidConfirmPassword").getAttribute("style")?alert("Invalid Password"):"display:;"==document.getElementById("userNameAlreadyUsed").getAttribute("style")?alert("User already exists!!!"):"display:;"==document.getElementById("emailAlreadyUsed").getAttribute("style")?alert("Email already used!!!"):n()}function a(){t.get("/userEmail/"+d).success(function(e){return e.email===d?document.getElementById("emailAlreadyUsed").setAttribute("style","display:;"):0===e?"display:;"==document.getElementById("emailAlreadyUsed").getAttribute("style")?(document.getElementById("emailAlreadyUsed").setAttribute("style","display:none;"),i()):i():void 0})}var l=this.user.firstname,r=this.user.lastname,o=this.user.username,d=this.user.email,u=this.user.password,m=this.user.confirmPassword,g=new RegExp(/[~`!#$%\^&*@+=\-\[\]\\';.,/{}|\\":<>\?]/),c=new RegExp(/[0-9]/),y=l.length;g.test(l)||c.test(l)||y>=20?document.getElementById("invalidFirstname").setAttribute("style","display:;"):"display:;"==document.getElementById("invalidFirstname").getAttribute("style")&&document.getElementById("invalidFirstname").setAttribute("style","display:none;");var p=r.length;g.test(r)||c.test(r)||p>=20?document.getElementById("invalidLastname").setAttribute("style","display:;"):"display:;"==document.getElementById("invalidLastname").getAttribute("style")&&document.getElementById("invalidLastname").setAttribute("style","display:none;"),o.length>20?document.getElementById("invalidusername").setAttribute("style","display:;"):"display:;"==document.getElementById("invalidusername").getAttribute("style")&&document.getElementById("invalidusername").setAttribute("style","display:none;");d.length;var h=d.includes("@");""==d?document.getElementById("invalidEmail").setAttribute("style","display:none;"):h?"display:;"==document.getElementById("invalidEmail").getAttribute("style")&&document.getElementById("invalidEmail").setAttribute("style","display:none;"):document.getElementById("invalidEmail").setAttribute("style","display:;");var f=u.length;""==u?document.getElementById("invalidPassword").setAttribute("style","display:none;"):f<6||f>15?document.getElementById("invalidPassword").setAttribute("style","display:;"):"display:;"==document.getElementById("invalidPassword").getAttribute("style")&&document.getElementById("invalidPassword").setAttribute("style","display:none;"),""==m?document.getElementById("invalidConfirmPassword").setAttribute("style","display:none;"):m!=u?document.getElementById("invalidConfirmPassword").setAttribute("style","display:;"):"display:;"==document.getElementById("invalidConfirmPassword").getAttribute("style")&&document.getElementById("invalidConfirmPassword").setAttribute("style","display:none;"),function(){t.get("/username/"+o).success(function(e){return e.username===o?document.getElementById("userNameAlreadyUsed").setAttribute("style","display:;"):0===e?"display:;"==document.getElementById("userNameAlreadyUsed").getAttribute("style")?(document.getElementById("userNameAlreadyUsed").setAttribute("style","display:none;"),a()):a():void 0})}()}}])}(),function(){ang.controller("viewCtrl",["$http","$location","$rootScope",function(e,t,s){if(localStorage.getItem("userId"))var n=localStorage.getItem("userId");else alert("User not logged-in. Please login again"),t.path("/home");var i=this;this.messageobj={},this.viewRow=s.viewRow;var a=this.viewRow;this.flag=!1,this.switchFlag=function(){this.flag=!this.flag},this.allMsg=function(){t.path("/message")},this.reply=function(){if(""==this.message)alert("Please type some message before sending it");else if(void 0==this.message)alert("Please type some message before sending it");else{var t=this.message,s=new Date,l=s.getDate().toString()+"/"+(s.getMonth()+1).toString()+"/"+s.getFullYear().toString();e.get("/reply/"+a.sendersId).success(function(s){i.messageobj.date=l,i.messageobj.from=a.to,i.messageobj.to=a.from,i.messageobj.message=t,i.messageobj.sendersId=n;i.messageobj;s.message.push(i.messageobj),e.put("/updateAfterReply/"+a.sendersId,s).success(function(e){})}),this.message="",this.allMsg()}}}])}();